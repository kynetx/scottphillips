<html>
	<script>
		//config
		appid = "a8x15";
		domains = [];
        var response = null;
		
		//handles pagerefreshes
		chrome.extension.onRequest.addListener(
		  function(message, sender, sendResponse) {
		    response = {plantTags:false};
			if (sender.tab){
				//from content script
				console.log(message.hostname)
				var plantTags = false;
				if (message.hostname) {
					for (i in domains) {
						var Kdomain = new RegExp(domains[i]);
						if (message.hostname.search(Kdomain) > -1) {
							plantTags = true;
							break;
						}
					}
				}
				
				if(plantTags){
					response = {
						plantTags:true,
						config: {
							rids: [appid],
							endpoint: {
								name: 'KBXch',
								version: '0.1',
								type: 'js'
							}
						}
					}
				}

			}
			console.log(sender.tab);
		    
		    sendResponse(response); // send back response
		  });
		  //load dispatch list
		  function loadDispatch(completecallback){
		  	domains = []; //clear it out
			var req = new XMLHttpRequest();  
			req.open('GET', "http://init.kobj.net/js/dispatch/"+appid+"?cachebust="+(new Date().getTime()), true);  
			req.onreadystatechange = function (aEvt) {  
			if (req.readyState == 4) {
			  if (req.status == 200) {
			  	var dispatchData = JSON.parse(req.responseText);
			  	for (i in dispatchData[appid]) {
					domain = dispatchData[appid][i];
					//alert(domain);
					domains.push(domain);
				}
				if (completecallback) completecallback();
			  	console.log(req.responseText);
			  } else {
			  	//alert("Error loading page\n");
			  }
			}
			
			};
			req.send(); 
		  }//end loadDispatch
		loadDispatch();
		
		
	</script>
	
	<body>
		My Background Page.
	</body>
</html>